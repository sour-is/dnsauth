dnsauth
=======

DNS Based Authentication 

This project uses TXT records from DNS as a store for public keys which can then be used to authenticate signatures.

Install
-------

The package requires git and mecurial to be installed for go to fetch the dependancies. 

    $ mkdir workspace
    $ cd workspace
    $ export GOPATH=`pwd`
    $ go get github.com/sour-is/dnsauth/dnsauth-cli

The finished executable will be in the bin directory.


Create a DNS entry
------------------

    $ bin/dnsauth-cli gentxt dummy1.sour.is dummy
    
    Private Key: 80ac0b83c0dcc9d91f59e8d865f7e409bad3749d2dcb379431fae3db830101f6f1
    dummy1.sour.is. IN TXT "algo:ecdsa curve:secp256k1 pubkey:BB7OT8hNBSqD8f0atJ6NH-MmZzSQNcSOKSjEjxOlKNHcL8lzVVPt_1XY9b37pZG1jkBn6rZlqCIAKbyc2aTa1P8"

   

Sign a token
------------

    $ bin/dnsauth-cli sign dummy1.sour.is dummy
    
    sig=IHcCY83WQwkS5REJY04yG9OAogq0f2qwiJGYljWyJcKl11-WgqaSU7EO1i3n9axIF0foXPpUqAROsDE6QgfERmkl5q3h


Verify a token
--------------

    $ bin/dnsauth-cli verify dummy1.sour.is IHcCY83WQwkS5REJY04yG9OAogq0f2qwiJGYljWyJcKl11-WgqaSU7EO1i3n9axIF0foXPpUqAROsDE6QgfERmkl5q3h
    
    Verify: true

Using the web interface
-----------------------

    $ bin/dnsauth-cli -v web
    INFO: 2014/05/26 12:28:47 web.go:17: Listen and Serve on port :8080 
    
    $ curl localhost:8080/auth/dummy1.sour.is -d sig=IHcCY83WQwkS5REJY04yG9OAogq0f2qwiJGYljWyJcKl11-WgqaSU7EO1i3n9axIF0foXPpUqAROsDE6QgfERmkl5q3h
    
    INFO: 2014/05/26 12:29:35 web.go:27: Ident: dummy1.sour.is
    INFO: 2014/05/26 12:29:35 web.go:43: PubKey: BB7OT8hNBSqD8f0atJ6NH-MmZzSQNcSOKSjEjxOlKNHcL8lzVVPt_1XY9b37pZG1jkBn6rZlqCIAKbyc2aTa1P8
    INFO: 2014/05/26 12:29:35 web.go:95: Signature: IHcCY83WQwkS5REJY04yG9OAogq0f2qwiJGYljWyJcKl11-WgqaSU7EO1i3n9axIF0foXPpUqAROsDE6QgfERmkl5q3h
    INFO: 2014/05/26 12:29:35 web.go:110: AuthPass: dummy1.sour.is true
    
    {"ident": "dummy1.sour.is", "auth": true}

The web interface can take the following as input in the post data: 

- sig=*[sig data]* where sig data is the signed signature generated by dnsauth-cli sign.
- sha=*[sha of password]* Where the value is the double sha256 of the password encoded with base64 (url-safe style '+/' => '-_').
- pass=*[password]* Were the password is passed in plantext.


OK, so how does it work?
-----------------------

It works by using [ECDSA](http://en.wikipedia.org/wiki/Elliptic_Curve_DSA)! 

The private key is generated using the domain name and password. the following pseudo code will demonstrate. 


    user = "dummy1.sour.is"
    pass = "dummy"
   
    // The private key in ECDSA is basically just a 256 bit value. (I am using the Koblitz curve as used for Bitcoin.)
    // I first take the SHA256 of the password. This allows the use of sending just the hash of the password to the web auth. 
    sha = SHA256(SHA256(pass)) 
   
    // Then i use Scrypt for the key generation with user as salt. 
   
    private = scrypt(user, sha, 16384, 8, 8, 32)

using the private key i can generate a public key which is stored in DNS.


For the authentication there are two steps. 
First, is signing a random nonce and appending it to the end of the signature. 

    nonce = rand(0, 2^32) // some random 4 byte value.

    R, S = sign(private, nonce)
    
    sig = base64(R + S + nonce)
    

Second, is verifying the signature.
  
    verify(private, nonce, R, S)
    
    // if true  : authentication passes
    // if false : authentication failed
